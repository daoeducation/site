---
layout: bare
---
<script src="https://js.stripe.com/v3/"></script>
<script type="text/javascript">
  var api_url = '{{ site.api_url }}';

  /* Handle any errors returns from Checkout  */
  var handleResult = function (result) {
    if (result.error) {
      var displayError = document.getElementById('error-message');
      displayError.textContent = result.error.message;
    }
  };

  // Create a Checkout Session with the selected quantity
  var createCheckoutSession = function(token) {
    return fetch(`${api_url}/stripe/checkout_sessions?token=${token}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
    }).then(function (result) {
      return result.json();
    });
  };

  /* Get your Stripe publishable key to initialize Stripe.js */
  $(function(){
    fetch(`${api_url}/stripe/config`)
      .then(function (result) { return result.json(); })
      .then(function (config) {
        window.recaptcha_loaded = function(){
          grecaptcha.ready(function() {
            grecaptcha.execute(config.recaptcha_site_key, {action: 'submit'}).then(function(token) {
              createCheckoutSession(token).then(function(data) {
                var stripe = Stripe(config.stripe_public_key);
                stripe.redirectToCheckout({sessionId: data.id }).then(handleResult);
              });
            });
          });
        }

        $('<script>')
          .attr('type', 'text/javascript')
          .attr('async', '')
          .attr('defer', '')
          .attr('src', "https://www.google.com/recaptcha/api.js?onload=recaptcha_loaded&render=" + config.recaptcha_site_key)
          .appendTo('body');
      })
  });
</script>

<div class="container payments text-center py-10">
  <img class="logo" src="/assets/images/logo.png" srcset="/assets/images/logo@2x.png 2x, /assets/images/logo@3x.png 3x" />
  <div class="mt-5">
    <i class="fas fa-circle-notch fa-spin"></i>
  </div>
  <div id="error-message"></div>
</div>
